version: "3"

services:
  duplicati:
    build:
      context: "."
    container_name: "duplicati"
    hostname: "${HOSTNAME:-duplicati}"
    environment:
      - "PUID=${PUID:-1000}"
      - "PGID=${PGID:-1000}"
      - "TZ=Europe/London"
      - "CLI_ARGS=--send-mail-to=bots@toastboy.co.uk --send-mail-from=bots@toastboy.co.uk --send-mail-username=bots@toastboy.co.uk --send-mail-password=QfgByXMGg6oVM8cbZ29M"
    restart: "always"
    volumes:
      - "/dev/rtc:/dev/rtc:ro"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      # Synced across hosts by syncthing - useful for migrating
      # restored backups around the place
      - "~toastboy/sync:/homedir_sync"
      - "config:/config"
      - "data:/data"
      - "source:/source"
      - "shared_backups:/backups"

volumes:
  config:
  data:
  source:
  shared_backups:
    external: true

networks:
  default:
    external:
      name: "shared_network"
